<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Aquatic Ecology Seminar Spring 2026 - Code</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./images/fish-teach.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Aquatic Ecology Seminar Spring 2026</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./literature.html" rel="" target="">
 <span class="menu-text">Literature</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./code.html" rel="" target="" aria-current="page">
 <span class="menu-text">Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mackwhite/aquatic-ecology-seminar" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://epa.ohio.gov/divisions-and-offices/surface-water/reports-data/statewide-biological-and-water-quality-monitoring-and-assessment" rel="" target="">
 <span class="menu-text">Ohio EPA</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-retrieval" id="toc-data-retrieval" class="nav-link active" data-scroll-target="#data-retrieval"><strong>Data Retrieval</strong></a>
  <ul class="collapse">
  <li><a href="#gathering-hydrology-data" id="toc-gathering-hydrology-data" class="nav-link" data-scroll-target="#gathering-hydrology-data"><strong>Gathering Hydrology Data</strong></a></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling"><strong>Data Wrangling</strong></a>
  <ul class="collapse">
  <li><a href="#linking-trait-data" id="toc-linking-trait-data" class="nav-link" data-scroll-target="#linking-trait-data"><strong>Linking trait data</strong></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Code</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This page houses a curated set of code examples designed to support students as they develop their own analytical frameworks. Rather than prescribing a single workflow, these examples introduce a range of R packages, functions, and approaches that students may, or may not be, accustomed to using in their own work. The goal is to expose students to different ways of working with data and to help them identify tools that are most appropriate for their research questions.</p>
<p>Students are encouraged to explore the code, modify it for their own purposes, and combine ideas across examples as their analyses. Code examples are grouped by theme (e.g., data retrieval, modeling, visualization).</p>
<section id="data-retrieval" class="level2">
<h2 class="anchored" data-anchor-id="data-retrieval"><strong>Data Retrieval</strong></h2>
<section id="gathering-hydrology-data" class="level3">
<h3 class="anchored" data-anchor-id="gathering-hydrology-data"><strong>Gathering Hydrology Data</strong></h3>
<p>Below we showcase code that can be used to gather data from stream gauges maintained by the United States Geological Survey (USGS) using the <a href="https://cran.r-project.org/web/packages/dataRetrieval/vignettes/dataRetrieval.html"><code>dataRetrieval</code></a> package. While some of you may be aware of (or even familiar with) the package, there are some relatively new (as of 11/2025) features outlined by USGS <a href="https://waterdata.usgs.gov/blog/dataretrieval/">here</a>.</p>
<p><strong>Housekeeping</strong></p>
<p><strong>Load necessary packages</strong></p>
<p><em>if you do not have librarian installed, you will need to install it first</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages('librarian')</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(tidyverse, dataRetrieval, rnaturalearth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://cran.r-project.org/web/packages/librarian/vignettes/intro-to-librarian.html"><code>librarian()</code></a> is nice because it automatically installs, updates, and attaches packages</p>
<p>First, we will use the <code>readNWISdata()</code> in the <code>dataRetrieval</code> package to pull all stream flow (CFS, i.e., parameter code <strong>00060</strong>) data <strong>for the state of Ohio</strong> - the default is daily average (i.e., stat code **00003* as seen in <code>rename()</code>). Check out the <a href="https://waterdata.usgs.gov/code-dictionary/#parameter-codes">link</a> to peruse all the parameter codes and their associated information</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>site_hydro <span class="ot">&lt;-</span> <span class="fu">readNWISdata</span>(<span class="at">stateCd =</span> <span class="st">'OH'</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">parameterCd =</span> <span class="st">'00060'</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">startDate =</span> <span class="st">'2023-12-01'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">endDate =</span> <span class="st">'2023-12-31'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>      janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">flow_cfs =</span> x_00060_00003,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">date =</span> date_time) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">day =</span> <span class="fu">day</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(date, year, month, day, site_no, flow_cfs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?format=waterml%2C1.1&amp;stateCd=OH&amp;parameterCd=00060&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
</div>
<p>I generally despise capital letters in column names, so I usually clean them up using the <code>clean_names()</code> function in the <a href="https://cran.r-project.org/web/packages/janitor/index.html"><code>janitor</code></a> package. I also frequently use the <code>glimpse()</code> function to make sure my code is running as planned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(site_hydro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,004
Columns: 6
$ date     &lt;dttm&gt; 2023-12-01, 2023-12-02, 2023-12-03, 2023-12-04, 2023-12-05, …
$ year     &lt;dbl&gt; 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2…
$ month    &lt;dbl&gt; 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 1…
$ day      &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18…
$ site_no  &lt;chr&gt; "03090500", "03090500", "03090500", "03090500", "03090500", "…
$ flow_cfs &lt;dbl&gt; 37.1, 36.1, 35.7, 35.4, 35.1, 33.5, 33.3, 44.7, 49.6, 199.0, …</code></pre>
</div>
</div>
<p>Next, we can pull out the <code>distinct()</code> sites to look up further metadata using the <code>readNWISsite()</code> function for each <strong>site_no</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sites <span class="ot">&lt;-</span> site_hydro <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(site_no)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>site_info <span class="ot">&lt;-</span> <span class="fu">readNWISsite</span>(<span class="at">siteNumbers =</span> sites<span class="sc">$</span>site_no) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(site_no, station_nm, dec_lat_va, dec_long_va) <span class="sc">|&gt;</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">lat =</span> dec_lat_va,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">lon =</span> dec_long_va,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">river =</span> station_nm) <span class="sc">|&gt;</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/site/?siteOutput=Expanded&amp;format=rdb&amp;site=03090500,03091500,03092090,03092460,03093000,03094000,03094704,03095500,03098600,03098700,03099500,03109500,03110000,03111500,03111548,03113990,03114306,03115400,03115644,03115712,03115786,03115917,03116000,03116077,03116196,03117000,03117500,03118000,03118500,03120500,03121500,03124500,03125900,03126000,03126910,03127000,03128500,03129000,03129197,03131300,03136500,03139000,03140000,03140500,03141500,03141870,03142000,03144000,03144500,03144816,03145000,03145173,03145483,03145534,03146000,03146402,03146500,03149500,03150000,03150500,03156400,03157000,03157500,03159500,03159540,03202000,03205470,03216070,03217424,03217500,03219500,03219781,03220000,03221000,03221646,03223425,03225500,03226800,03227107,03227500,03228300,03228500,03228689,03228750,03228805,03229500,03229610,03229796,03230310,03230427,03230450,03230500,03230700,03230800,03231500,03232000,03232300,03232500,03234000,03234300,03234500,03237020,03237280,03237500,03238495,03240000,03241500,03244936,03245500,03246500,03247500,03255349,03255420,03259000,03260706,03261500,03261950,03262000,03262500,03262700,03263000,03264000,03265000,03266000,03266560,03267000,03267900,03269500,03270000,03270500,03271000,03271300,03271500,03271620,03272000,03272100,03272700,03274000,03322485,04177000,04177266,04178000,04180988,04181049,04183500,04183979,04184500,04185000,04185318,04185440,04185935,04186500,04187100,04188100,04188252,04188324,04188337,04188400,04188433,04188496,04189000,04189131,04189174,04189260,04190000,04191058,04191444,04191500,04192500,04192574,04192599,04193500,04193999,04195500,04195820,04196000,04196500,04196800,04197100,04197137,04197152,04197170,04198000,04199000,04199155,04199500,04200500,04201400,04201409,04201423,04201484,04201495,04201500,04201526,04202000,04203900,04206000,04206413,04206416,04206425,04206448,04207200,04208000,04208347,04208460,042085017,04208502,04208684,04208700,04208923,04209000,04212100,04213000,394653084072100,402913084285400,402958084363300,410014081362600,410051081594500,410121081330300,410433081312500,411607084241200,411610084240800,412141081412100,412325081415500,412453081395500,412624081450700</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(site_info)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 226
Columns: 4
$ site_no &lt;chr&gt; "03090500", "03091500", "03092090", "03092460", "03093000", "0…
$ river   &lt;chr&gt; "Mahoning River bl Berlin Dam nr Berlin Center OH", "Mahoning …
$ lat     &lt;dbl&gt; 41.04839, 41.13145, 41.16145, 41.15700, 41.26117, 41.23922, 41…
$ lon     &lt;dbl&gt; -81.00120, -80.97120, -81.19705, -81.07176, -80.95426, -80.880…</code></pre>
</div>
</div>
<p>Lastly, we can pull the site hydrology and spatial information together using a <code>left_join()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>hydro <span class="ot">&lt;-</span> site_hydro <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(site_info) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">day =</span> <span class="fu">day</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(date, year, month, day, river, site_no, flow_cfs, lat, lon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(site_no)`</code></pre>
</div>
</div>
<p>For those not familiar, <code>left_join()</code> is one of <strong>many joins</strong> functions. I have attached a pretty robust introduction to these <a href="https://r4ds.hadley.nz/joins.html">here</a>. However, to be frank.. I rarely use anything other than <code>left_join()</code> (though see <code>anti_join()</code>), though I am certain there are reason to.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(hydro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,004
Columns: 9
$ date     &lt;dttm&gt; 2023-12-01, 2023-12-02, 2023-12-03, 2023-12-04, 2023-12-05, …
$ year     &lt;dbl&gt; 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2…
$ month    &lt;dbl&gt; 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 1…
$ day      &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18…
$ river    &lt;chr&gt; "Mahoning River bl Berlin Dam nr Berlin Center OH", "Mahoning…
$ site_no  &lt;chr&gt; "03090500", "03090500", "03090500", "03090500", "03090500", "…
$ flow_cfs &lt;dbl&gt; 37.1, 36.1, 35.7, 35.4, 35.1, 33.5, 33.3, 44.7, 49.6, 199.0, …
$ lat      &lt;dbl&gt; 41.04839, 41.04839, 41.04839, 41.04839, 41.04839, 41.04839, 4…
$ lon      &lt;dbl&gt; -81.0012, -81.0012, -81.0012, -81.0012, -81.0012, -81.0012, -…</code></pre>
</div>
</div>
<p>For a look at the spatial distribution of gauges, lets do a quick plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>hydro <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(site_no, lat, lon) <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">flow_m =</span> <span class="fu">mean</span>(flow_cfs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">color =</span> <span class="fu">log1p</span>(flow_m))) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">borders</span>(<span class="st">"state"</span>, <span class="at">regions =</span> <span class="st">"ohio"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"magma"</span>) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">'log(Mean CFS)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For those unfamiliar, the <code>borders()</code> function is very coarse, but good for a quick look like this</p>
<p>Next, we will use the <code>readNWISdv()</code> in the <code>dataRetrieval</code> package to pull stream flow (CFS) data <strong>for a list of sites</strong>, as opposed to the entire state as done above</p>
<p>First, we will create a list of sites with their site numbers. I have chose to use the <code>tribble()</code> function here. For those unfamiliar with <code>tribble()</code>, I have added some background information about tables, tibbles, and tribbles (oh my) <a href="https://alexander-pastukhov.github.io/data-analysis-using-r-for-psychology/tables.html">here</a>. When dealing with a lot of different sites it will be best to enter data into an excel document and read it in, however.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>site_hydro <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>river,                        <span class="sc">~</span>siteNumber,  </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Scioto-Columbus"</span>,             <span class="st">"03227500"</span>,            </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Maumuee-Defiance"</span>,            <span class="st">"04192500"</span>,            </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Little Muskingum-Bloomfield"</span>, <span class="st">"03115400"</span>,            </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Little Miami-Milford"</span>,        <span class="st">"03245500"</span>,           </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Hocking-Athens"</span>,              <span class="st">"03159500"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Olentangy-Deleware"</span>,          <span class="st">"03225500"</span>, </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have our sites, it is time to pull the flow data (parameter code <strong>00060</strong>) for all sites using the <code>map()</code> function in the <a href="https://cran.r-project.org/web/packages/purrr/purrr.pdf"><code>purrr</code></a> package. For those unaware, the <code>map()</code> function will change your left if you let it. Ditch the for loops and join us in the tidyverse. See video <a href="https://www.youtube.com/watch?v=nXQDiCTLTgU">here</a> for full explanation of the <code>map()</code> function, as well as <code>map_dbl()</code> and <code>map_dfr()</code> :)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>hydro <span class="ot">&lt;-</span> site_hydro <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">map</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                  siteNumber, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">~</span><span class="fu">readNWISdv</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">siteNumbers =</span> .x,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">parameterCd =</span> <span class="st">'00060'</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">startDate =</span> <span class="st">'2023-12-01'</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">endDate =</span> <span class="st">'2023-12-31'</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(river, siteNumber, data) <span class="sc">|&gt;</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">|&gt;</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">flow_cfs =</span> X_00060_00003, </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">date =</span> Date) <span class="sc">|&gt;</span> </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(river, flow_cfs, date) <span class="sc">|&gt;</span> </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">day =</span> <span class="fu">day</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(date, year, month, day,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>                    river, </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>                    flow_cfs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03227500&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=04192500&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03115400&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03245500&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03159500&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03225500&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
</div>
<p>Take a quick glimpse to make sure all went as planned</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(hydro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 186
Columns: 6
$ date     &lt;date&gt; 2023-12-01, 2023-12-02, 2023-12-03, 2023-12-04, 2023-12-05, …
$ year     &lt;dbl&gt; 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2…
$ month    &lt;dbl&gt; 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 1…
$ day      &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18…
$ river    &lt;chr&gt; "Scioto-Columbus", "Scioto-Columbus", "Scioto-Columbus", "Sci…
$ flow_cfs &lt;dbl&gt; 382, 327, 238, 229, 255, 279, 237, 227, 351, 530, 372, 783, 7…</code></pre>
</div>
</div>
<p>Next (and just for fun), I wanted to highlight how to use the <code>map2()</code> function, also maintained within the <code>purrr</code> package. Where <code>map()</code> iterates a function over a single vector or list, <code>map2()</code> iterates a function over (you guessed it) two vectors or lists.</p>
<p>I have set everything up according to our first example below. However, in this example I want to pull flow and temperature data from these sites so I need to specify that in terms of parameter codes (i.e., site_params). I also need to make sure that flow and temperature data is retrieved for all sites (where available). To create a data frame with all unique combinations of site and parameter code, I used the <code>crossing()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>site_hydro <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>river,                        <span class="sc">~</span>siteNumber,  </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Scioto-Columbus"</span>,             <span class="st">"03227500"</span>,            </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Maumuee-Defiance"</span>,            <span class="st">"04192500"</span>,            </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Little Muskingum-Bloomfield"</span>, <span class="st">"03115400"</span>,            </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Little Miami-Milford"</span>,        <span class="st">"03245500"</span>,           </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Hocking-Athens"</span>,              <span class="st">"03159500"</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Olentangy-Deleware"</span>,          <span class="st">"03225500"</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>site_params <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>parameterCd, <span class="sc">~</span>var,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">'00060'</span>, <span class="st">'FlowCFS'</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">'00010'</span>, <span class="st">'WaterTempC'</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>cross <span class="ot">&lt;-</span> <span class="fu">crossing</span>(site_hydro, site_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>hydro_and_temp <span class="ot">&lt;-</span> cross <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>            siteNumber, </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>            parameterCd,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span><span class="fu">readNWISdv</span>(</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">siteNumbers =</span> .x,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">parameterCd =</span> .y,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">startDate =</span> <span class="st">"2023-12-01"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">endDate =</span> <span class="st">"2023-12-31"</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>      )) <span class="sc">|&gt;</span> </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(river, siteNumber, parameterCd, var, data) <span class="sc">|&gt;</span> </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">|&gt;</span> </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">flow_cfs =</span> X_00060_00003,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">temp_c =</span> X_00010_00003,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">date =</span> Date) <span class="sc">|&gt;</span> </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">day =</span> <span class="fu">day</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(date, year, month, day, river, flow_cfs, temp_c) <span class="sc">|&gt;</span> </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(flow_cfs<span class="sc">:</span>temp_c, <span class="at">names_to =</span> <span class="st">'metric'</span>, <span class="at">values_to =</span> <span class="st">'value'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(metric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03159500&amp;format=waterml%2C1.1&amp;ParameterCd=00010&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03159500&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03245500&amp;format=waterml%2C1.1&amp;ParameterCd=00010&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03245500&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03115400&amp;format=waterml%2C1.1&amp;ParameterCd=00010&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03115400&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=04192500&amp;format=waterml%2C1.1&amp;ParameterCd=00010&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=04192500&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03225500&amp;format=waterml%2C1.1&amp;ParameterCd=00010&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03225500&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03227500&amp;format=waterml%2C1.1&amp;ParameterCd=00010&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GET:https://waterservices.usgs.gov/nwis/dv/?site=03227500&amp;format=waterml%2C1.1&amp;ParameterCd=00060&amp;StatCd=00003&amp;startDT=2023-12-01&amp;endDT=2023-12-31</code></pre>
</div>
</div>
</section>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling"><strong>Data Wrangling</strong></h2>
<section id="linking-trait-data" class="level3">
<h3 class="anchored" data-anchor-id="linking-trait-data"><strong>Linking trait data</strong></h3>
<p>Below we showcase code that can be used to generate a ‘species’ list and link it to an existing trait dataset</p>
<p><strong>Housekeeping</strong></p>
<p><strong>Load necessary packages</strong></p>
<p><em>if you do not have librarian installed, you will need to install it first</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages('librarian')</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(tidyverse, skimr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similar to above, I am using the <code>tribble()</code> and <code>crossing()</code> functions to generate simulate some data. I am coupling these functions with the <code>rlnorm()</code> function create an example count dataset of fishes commonly encountered in the state of Ohio</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>species <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>common_name,              <span class="sc">~</span>family,            <span class="sc">~</span>genus,        <span class="sc">~</span>species,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Largemouth Bass"</span>,         <span class="st">"Centrarchidae"</span>,    <span class="st">"Micropterus"</span>, <span class="st">"salmoides"</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Smallmouth Bass"</span>,         <span class="st">"Centrarchidae"</span>,    <span class="st">"Micropterus"</span>, <span class="st">"dolomieu"</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Bluegill"</span>,                <span class="st">"Centrarchidae"</span>,    <span class="st">"Lepomis"</span>,     <span class="st">"macrochirus"</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Channel Catfish"</span>,         <span class="st">"Ictaluridae"</span>,      <span class="st">"Ictalurus"</span>,   <span class="st">"punctatus"</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Flathead Catfish"</span>,        <span class="st">"Ictaluridae"</span>,      <span class="st">"Pylodictis"</span>,  <span class="st">"olivaris"</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Common Carp"</span>,             <span class="st">"Cyprinidae"</span>,       <span class="st">"Cyprinus"</span>,    <span class="st">"carpio"</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Gizzard Shad"</span>,            <span class="st">"Clupeidae"</span>,        <span class="st">"Dorosoma"</span>,    <span class="st">"cepedianum"</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Emerald Shiner"</span>,          <span class="st">"Cyprinidae"</span>,       <span class="st">"Notropis"</span>,    <span class="st">"atherinoides"</span>,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Creek Chub"</span>,              <span class="st">"Cyprinidae"</span>,       <span class="st">"Semotilus"</span>,   <span class="st">"atromaculatus"</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Logperch"</span>,                <span class="st">"Percidae"</span>,         <span class="st">"Percina"</span>,     <span class="st">"caprodes"</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>sites <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>river,                          </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Scioto-Columbus"</span>,                         </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Maumuee-Defiance"</span>,                      </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Little Muskingum-Bloomfield"</span>,           </span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Little Miami-Milford"</span>,                   </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Hocking-Athens"</span>,             </span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Olentangy-Deleware"</span>,         </span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">year =</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2025</span>)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">crossing</span>(species, sites, years) <span class="sc">|&gt;</span> </span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(year, river, common_name, family, genus, species) <span class="sc">|&gt;</span> </span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">round</span>(<span class="fu">rlnorm</span>(<span class="fu">n</span>(), <span class="at">meanlog =</span> <span class="dv">1</span>, <span class="at">sdlog =</span> <span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,560
Columns: 7
$ year        &lt;int&gt; 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009…
$ river       &lt;chr&gt; "Hocking-Athens", "Hocking-Athens", "Hocking-Athens", "Hoc…
$ common_name &lt;chr&gt; "Bluegill", "Bluegill", "Bluegill", "Bluegill", "Bluegill"…
$ family      &lt;chr&gt; "Centrarchidae", "Centrarchidae", "Centrarchidae", "Centra…
$ genus       &lt;chr&gt; "Lepomis", "Lepomis", "Lepomis", "Lepomis", "Lepomis", "Le…
$ species     &lt;chr&gt; "macrochirus", "macrochirus", "macrochirus", "macrochirus"…
$ count       &lt;dbl&gt; 5, 2, 1, 4, 0, 2, 2, 2, 11, 4, 3, 1, 1, 3, 1, 5, 1, 13, 5,…</code></pre>
</div>
</div>
<p>I am going to take a similar approach to generate an example trait dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>traits <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>species,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>max_length_mm, <span class="sc">~</span>age_maturity_yr, <span class="sc">~</span>longevity_yr, <span class="sc">~</span>egg_size_mm,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>mean_clutch_size, <span class="sc">~</span>parental_care,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>larval_growth_mm_mo, <span class="sc">~</span>yoy_growth_mm_yr, <span class="sc">~</span>adult_growth_mm_yr,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>spawn_season_d,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Largemouth Bass"</span>,        <span class="dv">600</span>, <span class="fl">3.5</span>, <span class="dv">14</span>, <span class="fl">1.8</span>, <span class="dv">120000</span>, <span class="dv">3</span>, <span class="dv">15</span>, <span class="dv">120</span>, <span class="dv">40</span>, <span class="dv">90</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Smallmouth Bass"</span>,        <span class="dv">550</span>, <span class="fl">4.0</span>, <span class="dv">12</span>, <span class="fl">2.0</span>,  <span class="dv">90000</span>, <span class="dv">3</span>, <span class="dv">14</span>, <span class="dv">110</span>, <span class="dv">38</span>, <span class="dv">80</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Spotted Bass"</span>,           <span class="dv">500</span>, <span class="fl">3.0</span>, <span class="dv">11</span>, <span class="fl">1.7</span>,  <span class="dv">85000</span>, <span class="dv">3</span>, <span class="dv">14</span>, <span class="dv">105</span>, <span class="dv">36</span>, <span class="dv">85</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Bluegill"</span>,               <span class="dv">300</span>, <span class="fl">2.0</span>,  <span class="dv">8</span>, <span class="fl">1.2</span>,  <span class="dv">45000</span>, <span class="dv">2</span>, <span class="dv">18</span>,  <span class="dv">95</span>, <span class="dv">32</span>, <span class="dv">110</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Redear Sunfish"</span>,         <span class="dv">350</span>, <span class="fl">2.5</span>,  <span class="dv">9</span>, <span class="fl">1.4</span>,  <span class="dv">52000</span>, <span class="dv">2</span>, <span class="dv">17</span>, <span class="dv">100</span>, <span class="dv">33</span>, <span class="dv">105</span>,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Green Sunfish"</span>,          <span class="dv">280</span>, <span class="fl">1.8</span>,  <span class="dv">7</span>, <span class="fl">1.1</span>,  <span class="dv">40000</span>, <span class="dv">2</span>, <span class="dv">19</span>,  <span class="dv">90</span>, <span class="dv">30</span>, <span class="dv">115</span>,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Channel Catfish"</span>,        <span class="dv">800</span>, <span class="fl">5.0</span>, <span class="dv">18</span>, <span class="fl">5.5</span>,  <span class="dv">18000</span>, <span class="dv">5</span>, <span class="dv">10</span>,  <span class="dv">85</span>, <span class="dv">30</span>, <span class="dv">60</span>,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Flathead Catfish"</span>,      <span class="dv">1100</span>, <span class="fl">6.0</span>, <span class="dv">22</span>, <span class="fl">6.2</span>,   <span class="dv">9000</span>, <span class="dv">6</span>,  <span class="dv">9</span>,  <span class="dv">75</span>, <span class="dv">28</span>, <span class="dv">55</span>,</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Blue Catfish"</span>,          <span class="dv">1200</span>, <span class="fl">6.5</span>, <span class="dv">25</span>, <span class="fl">6.0</span>,  <span class="dv">20000</span>, <span class="dv">5</span>,  <span class="dv">9</span>,  <span class="dv">80</span>, <span class="dv">29</span>, <span class="dv">65</span>,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Common Carp"</span>,           <span class="dv">1000</span>, <span class="fl">4.0</span>, <span class="dv">20</span>, <span class="fl">1.5</span>, <span class="dv">250000</span>, <span class="dv">0</span>, <span class="dv">16</span>, <span class="dv">130</span>, <span class="dv">42</span>, <span class="dv">120</span>,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Grass Carp"</span>,            <span class="dv">1300</span>, <span class="fl">5.0</span>, <span class="dv">22</span>, <span class="fl">1.6</span>, <span class="dv">300000</span>, <span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">135</span>, <span class="dv">45</span>, <span class="dv">125</span>,</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Goldfish"</span>,               <span class="dv">400</span>, <span class="fl">2.0</span>, <span class="dv">10</span>, <span class="fl">1.3</span>, <span class="dv">100000</span>, <span class="dv">0</span>, <span class="dv">17</span>, <span class="dv">110</span>, <span class="dv">35</span>, <span class="dv">115</span>,</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Gizzard Shad"</span>,           <span class="dv">450</span>, <span class="fl">2.0</span>, <span class="dv">10</span>, <span class="fl">1.1</span>, <span class="dv">180000</span>, <span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">140</span>, <span class="dv">48</span>, <span class="dv">130</span>,</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Threadfin Shad"</span>,         <span class="dv">300</span>, <span class="fl">1.5</span>,  <span class="dv">6</span>, <span class="fl">0.9</span>, <span class="dv">160000</span>, <span class="dv">0</span>, <span class="dv">22</span>, <span class="dv">150</span>, <span class="dv">50</span>, <span class="dv">140</span>,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Emerald Shiner"</span>,         <span class="dv">120</span>, <span class="fl">1.0</span>,  <span class="dv">4</span>, <span class="fl">0.9</span>,  <span class="dv">12000</span>, <span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">160</span>, <span class="dv">55</span>, <span class="dv">100</span>,</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Sand Shiner"</span>,            <span class="dv">140</span>, <span class="fl">1.2</span>,  <span class="dv">5</span>, <span class="fl">1.0</span>,  <span class="dv">15000</span>, <span class="dv">0</span>, <span class="dv">24</span>, <span class="dv">155</span>, <span class="dv">52</span>, <span class="dv">105</span>,</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Creek Chub"</span>,             <span class="dv">220</span>, <span class="fl">2.0</span>,  <span class="dv">6</span>, <span class="fl">1.0</span>,  <span class="dv">25000</span>, <span class="dv">1</span>, <span class="dv">21</span>, <span class="dv">145</span>, <span class="dv">48</span>, <span class="dv">110</span>,</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Bluntnose Minnow"</span>,       <span class="dv">110</span>, <span class="fl">1.0</span>,  <span class="dv">3</span>, <span class="fl">0.8</span>,  <span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">26</span>, <span class="dv">165</span>, <span class="dv">58</span>, <span class="dv">95</span>,</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Logperch"</span>,               <span class="dv">180</span>, <span class="fl">2.5</span>,  <span class="dv">7</span>, <span class="fl">1.3</span>,  <span class="dv">18000</span>, <span class="dv">1</span>, <span class="dv">18</span>, <span class="dv">125</span>, <span class="dv">40</span>, <span class="dv">75</span>,</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Johnny Darter"</span>,           <span class="dv">90</span>, <span class="fl">1.2</span>,  <span class="dv">4</span>, <span class="fl">1.0</span>,   <span class="dv">8000</span>, <span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">135</span>, <span class="dv">45</span>, <span class="dv">70</span>,</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Yellow Perch"</span>,           <span class="dv">400</span>, <span class="fl">3.0</span>, <span class="dv">10</span>, <span class="fl">2.1</span>,  <span class="dv">50000</span>, <span class="dv">0</span>, <span class="dv">16</span>, <span class="dv">115</span>, <span class="dv">37</span>, <span class="dv">85</span>,</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Freshwater Drum"</span>,        <span class="dv">700</span>, <span class="fl">4.5</span>, <span class="dv">16</span>, <span class="fl">1.9</span>, <span class="dv">200000</span>, <span class="dv">0</span>, <span class="dv">14</span>, <span class="dv">105</span>, <span class="dv">35</span>, <span class="dv">95</span>,</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>      <span class="st">"White Crappie"</span>,          <span class="dv">420</span>, <span class="fl">3.0</span>,  <span class="dv">9</span>, <span class="fl">1.6</span>, <span class="dv">120000</span>, <span class="dv">2</span>, <span class="dv">17</span>, <span class="dv">120</span>, <span class="dv">38</span>, <span class="dv">100</span>,</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Black Crappie"</span>,          <span class="dv">450</span>, <span class="fl">3.2</span>, <span class="dv">10</span>, <span class="fl">1.7</span>, <span class="dv">130000</span>, <span class="dv">2</span>, <span class="dv">16</span>, <span class="dv">118</span>, <span class="dv">37</span>, <span class="dv">98</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(traits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 24
Columns: 11
$ species             &lt;chr&gt; "Largemouth Bass", "Smallmouth Bass", "Spotted Bas…
$ max_length_mm       &lt;dbl&gt; 600, 550, 500, 300, 350, 280, 800, 1100, 1200, 100…
$ age_maturity_yr     &lt;dbl&gt; 3.5, 4.0, 3.0, 2.0, 2.5, 1.8, 5.0, 6.0, 6.5, 4.0, …
$ longevity_yr        &lt;dbl&gt; 14, 12, 11, 8, 9, 7, 18, 22, 25, 20, 22, 10, 10, 6…
$ egg_size_mm         &lt;dbl&gt; 1.8, 2.0, 1.7, 1.2, 1.4, 1.1, 5.5, 6.2, 6.0, 1.5, …
$ mean_clutch_size    &lt;dbl&gt; 120000, 90000, 85000, 45000, 52000, 40000, 18000, …
$ parental_care       &lt;dbl&gt; 3, 3, 3, 2, 2, 2, 5, 6, 5, 0, 0, 0, 0, 0, 0, 0, 1,…
$ larval_growth_mm_mo &lt;dbl&gt; 15, 14, 14, 18, 17, 19, 10, 9, 9, 16, 15, 17, 20, …
$ yoy_growth_mm_yr    &lt;dbl&gt; 120, 110, 105, 95, 100, 90, 85, 75, 80, 130, 135, …
$ adult_growth_mm_yr  &lt;dbl&gt; 40, 38, 36, 32, 33, 30, 30, 28, 29, 42, 45, 35, 48…
$ spawn_season_d      &lt;dbl&gt; 90, 80, 85, 110, 105, 115, 60, 55, 65, 120, 125, 1…</code></pre>
</div>
</div>
<p>The first thing we will want to do is create a ‘species’ list. I put species in quotations, as we do not always have species-level information. All you need here is a dataset that includes all of the unique taxonomic identities present in your larger dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>species_list <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(common_name, family, genus, species) <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>()</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(species_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   common_name      family        genus       species      
   &lt;chr&gt;            &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;        
 1 Bluegill         Centrarchidae Lepomis     macrochirus  
 2 Channel Catfish  Ictaluridae   Ictalurus   punctatus    
 3 Common Carp      Cyprinidae    Cyprinus    carpio       
 4 Creek Chub       Cyprinidae    Semotilus   atromaculatus
 5 Emerald Shiner   Cyprinidae    Notropis    atherinoides 
 6 Flathead Catfish Ictaluridae   Pylodictis  olivaris     
 7 Gizzard Shad     Clupeidae     Dorosoma    cepedianum   
 8 Largemouth Bass  Centrarchidae Micropterus salmoides    
 9 Logperch         Percidae      Percina     caprodes     
10 Smallmouth Bass  Centrarchidae Micropterus dolomieu     </code></pre>
</div>
</div>
<p>Next, we link the trait data to our taxonomic data - ensure that you have a key column for which you can join the two discrete data streams (i.e., rename = species). If ‘key column’ is a new concept to you, please check out this article that does a great job discussing terminology and approaches to data wrangling and harmonization :)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>traits <span class="ot">&lt;-</span> traits <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">common_name =</span> species)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>species_traits <span class="ot">&lt;-</span> species_list <span class="sc">|&gt;</span> <span class="fu">left_join</span>(traits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(common_name)`</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(species_traits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 10
Columns: 14
$ common_name         &lt;chr&gt; "Bluegill", "Channel Catfish", "Common Carp", "Cre…
$ family              &lt;chr&gt; "Centrarchidae", "Ictaluridae", "Cyprinidae", "Cyp…
$ genus               &lt;chr&gt; "Lepomis", "Ictalurus", "Cyprinus", "Semotilus", "…
$ species             &lt;chr&gt; "macrochirus", "punctatus", "carpio", "atromaculat…
$ max_length_mm       &lt;dbl&gt; 300, 800, 1000, 220, 120, 1100, 450, 600, 180, 550
$ age_maturity_yr     &lt;dbl&gt; 2.0, 5.0, 4.0, 2.0, 1.0, 6.0, 2.0, 3.5, 2.5, 4.0
$ longevity_yr        &lt;dbl&gt; 8, 18, 20, 6, 4, 22, 10, 14, 7, 12
$ egg_size_mm         &lt;dbl&gt; 1.2, 5.5, 1.5, 1.0, 0.9, 6.2, 1.1, 1.8, 1.3, 2.0
$ mean_clutch_size    &lt;dbl&gt; 45000, 18000, 250000, 25000, 12000, 9000, 180000, …
$ parental_care       &lt;dbl&gt; 2, 5, 0, 1, 0, 6, 0, 3, 1, 3
$ larval_growth_mm_mo &lt;dbl&gt; 18, 10, 16, 21, 25, 9, 20, 15, 18, 14
$ yoy_growth_mm_yr    &lt;dbl&gt; 95, 85, 130, 145, 160, 75, 140, 120, 125, 110
$ adult_growth_mm_yr  &lt;dbl&gt; 32, 30, 42, 48, 55, 28, 48, 40, 40, 38
$ spawn_season_d      &lt;dbl&gt; 110, 60, 120, 110, 100, 55, 130, 90, 75, 80</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(species_traits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">species_traits</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">common_name</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">family</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">genus</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">species</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">max_length_mm</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">532.00</td>
<td style="text-align: right;">344.80</td>
<td style="text-align: right;">120.0</td>
<td style="text-align: right;">240.00</td>
<td style="text-align: right;">500.0</td>
<td style="text-align: right;">750.00</td>
<td style="text-align: right;">1.1e+03</td>
<td style="text-align: left;">▇▂▃▂▃</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_maturity_yr</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.20</td>
<td style="text-align: right;">1.57</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">6.0e+00</td>
<td style="text-align: left;">▇▂▆▂▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">longevity_yr</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12.10</td>
<td style="text-align: right;">6.23</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">7.25</td>
<td style="text-align: right;">11.0</td>
<td style="text-align: right;">17.00</td>
<td style="text-align: right;">2.2e+01</td>
<td style="text-align: left;">▇▅▅▂▅</td>
</tr>
<tr class="even">
<td style="text-align: left;">egg_size_mm</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.25</td>
<td style="text-align: right;">1.94</td>
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">1.12</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">1.95</td>
<td style="text-align: right;">6.2e+00</td>
<td style="text-align: left;">▇▁▁▁▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mean_clutch_size</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">76700.00</td>
<td style="text-align: right;">83062.29</td>
<td style="text-align: right;">9000.0</td>
<td style="text-align: right;">18000.00</td>
<td style="text-align: right;">35000.0</td>
<td style="text-align: right;">112500.00</td>
<td style="text-align: right;">2.5e+05</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">parental_care</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.10</td>
<td style="text-align: right;">2.13</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">6.0e+00</td>
<td style="text-align: left;">▇▂▃▁▃</td>
</tr>
<tr class="odd">
<td style="text-align: left;">larval_growth_mm_mo</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16.60</td>
<td style="text-align: right;">4.90</td>
<td style="text-align: right;">9.0</td>
<td style="text-align: right;">14.25</td>
<td style="text-align: right;">17.0</td>
<td style="text-align: right;">19.50</td>
<td style="text-align: right;">2.5e+01</td>
<td style="text-align: left;">▅▅▇▅▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">yoy_growth_mm_yr</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">118.50</td>
<td style="text-align: right;">27.29</td>
<td style="text-align: right;">75.0</td>
<td style="text-align: right;">98.75</td>
<td style="text-align: right;">122.5</td>
<td style="text-align: right;">137.50</td>
<td style="text-align: right;">1.6e+02</td>
<td style="text-align: left;">▅▂▇▅▅</td>
</tr>
<tr class="odd">
<td style="text-align: left;">adult_growth_mm_yr</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">40.10</td>
<td style="text-align: right;">8.62</td>
<td style="text-align: right;">28.0</td>
<td style="text-align: right;">33.50</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: right;">46.50</td>
<td style="text-align: right;">5.5e+01</td>
<td style="text-align: left;">▇▂▇▅▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">spawn_season_d</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">93.00</td>
<td style="text-align: right;">25.30</td>
<td style="text-align: right;">55.0</td>
<td style="text-align: right;">76.25</td>
<td style="text-align: right;">95.0</td>
<td style="text-align: right;">110.00</td>
<td style="text-align: right;">1.3e+02</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In addition to my usual <code>glimpse()</code>, you will notice I used the <code>skim()</code> function from the <a href="https://docs.ropensci.org/skimr/"><code>skimr</code></a> package - super useful for a quick look at how data are distributed or if data are missing</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>